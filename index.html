<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Proveedores • TuMarca</title>
  <meta name="description" content="Directorio de proveedores de juegos — slots, mesa, crash, live y más." />
  <style>
    :root{
      --bg:#0e0f13; --card:#161823; --ink:#e8eaf2; --muted:#aeb3c2;
      --brand:#ff5ea8; --accent:#6cf0d2; --chip:#232633; --ok:#3bd17f;
      --radius:14px; --gap:14px; --shadow:0 6px 24px rgba(0,0,0,.18);
    }
    @media (prefers-color-scheme: light){
      :root{--bg:#fafbff; --card:#ffffff; --ink:#0e1020; --muted:#545b70; --chip:#eef1f7; --shadow:0 6px 24px rgba(20,30,60,.08);}
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:500 15px/1.5 ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:auto;padding:28px}
    header.hero{display:grid;gap:12px;margin-bottom:18px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .kpis{display:flex;gap:10px;flex-wrap:wrap}
    .kpi{background:var(--chip);border-radius:999px;padding:6px 12px;font-size:13px;color:var(--muted)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;background:var(--card);padding:12px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .toolbar input[type=search]{flex:1;min-width:200px;padding:10px 12px;border:1px solid transparent;background:var(--chip);color:var(--ink);border-radius:10px;outline:none}
    .toolbar .select{display:flex;gap:8px;align-items:center}
    select{padding:10px 12px;border-radius:10px;border:1px solid transparent;background:var(--chip);color:var(--ink)}
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:var(--chip);padding:8px 10px;border-radius:999px;cursor:pointer;user-select:none}
    .chip input{display:none}
    .chip.active, .chip:has(input:checked){outline:2px solid var(--brand)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:var(--gap);margin-top:16px}
    .card{grid-column:span 12;background:var(--card);border-radius:var(--radius);padding:14px;display:grid;grid-template-columns:84px 1fr;gap:14px;align-items:center;box-shadow:var(--shadow)}
    @media (min-width:640px){.card{grid-column:span 6}}
    @media (min-width:980px){.card{grid-column:span 4}}
    .logoBox{width:84px;height:84px;border-radius:12px;background:linear-gradient(135deg,var(--chip),transparent);display:grid;place-items:center;overflow:hidden}
    .logoBox img{width:100%;height:100%;object-fit:contain}
    .logoBox .fallback{font-weight:800;font-size:18px;color:var(--muted)}
    .meta h3{margin:0 0 4px 0;font-size:18px;display:flex;gap:8px;align-items:center}
    .badge{font-size:11px;background:linear-gradient(135deg,var(--brand),var(--accent));color:#0a0c10;padding:3px 8px;border-radius:999px}
    .meta p{margin:0;color:var(--muted)}
    .tags{margin-top:8px;display:flex;gap:6px;flex-wrap:wrap}
    .tag{font-size:12px;background:var(--chip);padding:4px 8px;border-radius:999px}
    .row{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:10px}
    .cta{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid transparent;background:var(--brand);color:#0b0c12;font-weight:700;text-decoration:none}
    .btn.ghost{background:transparent;border-color:var(--chip);color:var(--ink)}
    .rtp{font-size:12px;color:var(--muted)}
    .footnote{margin-top:26px;color:var(--muted);font-size:13px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap" itemscope itemtype="https://schema.org/ItemList">
    <div class="topbar">
      <strong>TuMarca</strong>
      <div class="cta">
        <a class="btn ghost" href="admin.html">Admin</a>
        <a class="btn" href="#" id="logoutBtn" style="display:none">Salir</a>
      </div>
    </div>
    <header class="hero">
      <h1 style="margin:0;font-size:28px">Proveedores de Juegos</h1>
      <div class="kpis">
        <div class="kpi"><strong id="count">0</strong>&nbsp;proveedores</div>
        <div class="kpi">Actualizado <time id="today"></time></div>
      </div>
      <form class="toolbar" onsubmit="event.preventDefault()">
        <input id="q" type="search" placeholder="Buscar por nombre, tag o categoría (p. ej., slots, live, crash)…" aria-label="Buscar proveedores">
        <div class="select">
          <label for="sort" class="sr">Ordenar</label>
          <select id="sort">
            <option value="featured">Destacados</option>
            <option value="az">A–Z</option>
            <option value="za">Z–A</option>
          </select>
        </div>
        <div class="filters" role="group" aria-label="Filtros">
          <label class="chip"><input type="checkbox" value="slots"> Slots</label>
          <label class="chip"><input type="checkbox" value="live"> Live</label>
          <label class="chip"><input type="checkbox" value="mesa"> Mesa</label>
          <label class="chip"><input type="checkbox" value="crash"> Crash</label>
          <label class="chip"><input type="checkbox" value="provably-fair"> Provably-Fair</label>
          <label class="chip"><input type="checkbox" value="mobile"> Mobile</label>
        </div>
      </form>
    </header>

    <section id="grid" class="grid" aria-live="polite"></section>

    <p class="footnote">
      ⚠️ Contenido para mayores de 18 años. Practicá juego responsable. Antes de listar un proveedor, verificá <strong>licencias</strong> y requisitos regulatorios de tu jurisdicción. Este sitio no ofrece juego por dinero: es un catálogo informativo.
    </p>
  </div>

<div id="gate" style="display:none"> ... </div>
  <form id="login_form" style="background:#161823;padding:20px;border-radius:12px;min-width:280px;color:#e8eaf2">
    <h3 style="margin:0 0 10px">Ingresar</h3>
    <label>Usuario (ID)
      <input name="user_id" required style="width:100%;padding:10px;border-radius:8px;margin:6px 0">
    </label>
    <label>PIN
      <input name="pin" type="password" required minlength="4" style="width:100%;padding:10px;border-radius:8px;margin:6px 0">
    </label>
    <button style="width:100%;padding:10px;border-radius:8px;font-weight:700">Entrar</button>
    <p id="login_err" style="color:#f88"></p>
    <p class="muted">¿Olvidaste el PIN? Escribinos por WhatsApp.</p>
  </form>
</div>

  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script>
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => [...ctx.querySelectorAll(sel)];

    const today = new Date();
    $("#today").textContent = today.toLocaleDateString("es-AR", {year:"numeric", month:"short", day:"2-digit"});

    async function loadProviders(){
      try {
        const res = await fetch('data/providers.json');
        const {providers} = await res.json();
        window.__PROVIDERS = providers;
        render();
      } catch(e) {
        document.getElementById('grid').innerHTML = '<p class="muted">No se pudo cargar data/providers.json</p>';
      }
    }

    const state = { q:'', categories:new Set(), sort:'featured' };
    $("#q").addEventListener("input", e => { state.q = e.target.value.trim().toLowerCase(); render(); });
    $("#sort").addEventListener("change", e => { state.sort = e.target.value; render(); });
    $$(".filters .chip input").forEach(cb=>{
      cb.addEventListener("change", e=>{
        e.target.checked ? state.categories.add(e.target.value) : state.categories.delete(e.target.value);
        render();
      });
      cb.closest(".chip").addEventListener("click",()=>{
        cb.closest(".chip").classList.toggle("active", cb.checked);
      });
    });

    function matchProvider(p){
      const q = state.q;
      const catOK = state.categories.size===0 || [...state.categories].every(c => p.categories.includes(c));
      const text = (p.name+" "+p.short+" "+(p.tags||[]).join(" ")+" "+p.categories.join(" ")).toLowerCase();
      const qOK = !q || text.includes(q);
      return catOK && qOK;
    }
    function sortProviders(list){
      if(state.sort==="az") return list.sort((a,b)=>a.name.localeCompare(b.name));
      if(state.sort==="za") return list.sort((a,b)=>b.name.localeCompare(a.name));
      return list.sort((a,b)=>{
        if(a.featured && !b.featured) return -1;
        if(!a.featured && b.featured) return 1;
        return a.name.localeCompare(b.name);
      });
    }
    function logoFallback(name){
        const initials = name.split(" ").map(w=>w[0]).join("").slice(0,3).toUpperCase();
        return `<div class="fallback">${initials}</div>`;
    }
    function card(p, idx){
      const badges = p.featured ? `<span class="badge">Destacado</span>` : "";
      const tags = (p.tags||[]).slice(0,6).map(t=>`<span class="tag">${t}</span>`).join("");
      const cats = (p.categories||[]).map(t=>`<span class="tag">${t}</span>`).join("");
      const website = p.website ? `<a class="btn ghost" href="${p.website}" target="_blank" rel="nofollow noopener">Sitio oficial</a>` : "";
      return `
        <article class="card" itemprop="itemListElement" itemscope itemtype="https://schema.org/Organization" data-name="${p.name.toLowerCase()}">
          <meta itemprop="position" content="${idx+1}">
          <div class="logoBox">
            <img src="${p.logo}" alt="Logo de ${p.name}" loading="lazy" onerror="this.replaceWith(document.createRange().createContextualFragment('${logoFallback(p.name)}'))">
          </div>
          <div class="meta">
            <h3 itemprop="name">${p.name} ${badges}</h3>
            <p itemprop="description">${p.short}</p>
            <div class="tags">${cats}${tags}</div>
            <div class="row">
              <div class="rtp">${p.licenses_note||''}</div>
              <div class="cta">
                <a class="btn" href="./proveedores/${p.slug}.html"> Ver juegos </a>
                ${website}
              </div>
            </div>
          </div>
        </article>`;
    }
    function render(){
      const list = (window.__PROVIDERS||[]).filter(matchProvider);
      const sorted = sortProviders(list);
      document.getElementById('grid').innerHTML = sorted.map(card).join("") || `<p style="color:var(--muted);margin:8px 0 24px">No hay resultados para tu búsqueda.</p>`;
      document.getElementById('count').textContent = list.length;
    }

    loadProviders();

    document.addEventListener('login:ok', ()=>{ document.getElementById('logoutBtn').style.display='inline-flex'; });
    document.getElementById('logoutBtn').onclick = ()=>{ logout(); location.reload(); };
  </script>
</body>
</html>
